<template>
  <div id="svgs">
  <!-- SVG1 -->
  <div id="svg1" v-bind:class="{ hide: isHideSVG1, show: !isHideSVG1 }">
  <svg id="sl_svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 463.5">
  <g id="svg1_sl_wrap">
    <g id="me_after">
      <path id="me_after_path" class="cls-1" d="M338,1078l-2-2a11.64,11.64,0,0,1-2-3l-2-4c-1-2-2-5-3-7a54.15,54.15,0,0,0-3-6c-2-3-1.14-2.14-2-3s0,0-2-3c-1.24-1.86-1-4-4-11-1.64-3.82-3.86-8.3-8-8-4,.29-7,8-8,10s-1,9-1,11c0,2.91,1,10,1,11,0,2,0,0,1,4a32.53,32.53,0,0,0,1,6c2,6,1.55,5.11,2,6,2,4,2,3,3,5,.63,1.26,1,3,2,4a12.38,12.38,0,0,1,2,3,9.67,9.67,0,0,0,2,3,32.62,32.62,0,0,1,3,3Z" transform="translate(2.51 -737.52)" />
      <g id="leaf"　v-show="isShowLeaf">
        <g id="leaf_left">
          <path id="leaf_left_path" class="cls-3" d="M236,860h-4l-2-2v-4l2-1,1-1,2,1,2,1s1.41.57,0,2Z" transform="translate(2.51 -737.52)"/>
          <path class="cls-2 leaf" v-bind:class="{ fadein: isFadeinLeaves, fadeout: isFadeoutLeaves }" d="M68.19,776.28c7.29-10.93,20.49-15.25,33-16.21,13.42-1,27.14,1.26,40.06,4.76a160.4,160.4,0,0,1,38,15.82,163.06,163.06,0,0,1,32.81,24.86A155.14,155.14,0,0,1,237.54,838q1.28,2.19,2.48,4.42c.46.84,1.76.09,1.3-.76a156.3,156.3,0,0,0-24.87-33.92,164.73,164.73,0,0,0-32.71-26.23,162.9,162.9,0,0,0-38.44-17.14c-13.07-3.88-27-6.49-40.67-6-12.57.43-26.25,3.7-34.91,13.47a33.52,33.52,0,0,0-2.82,3.68c-.54.8.76,1.55,1.29.75Z" transform="translate(2.51 -737.52)"/>
          <!--
          <path class="cls-2" d="M231.47,865.26c-19.2,3.73-38.91,1.92-58-1.51-9.31-1.67-18.56-3.69-27.78-5.78-8.39-1.9-16.75-4-24.93-6.63C105,846.21,89.67,838.59,78.63,826c-10.07-11.5-16.79-27.12-14.23-42.6,2.5-15.13,13.42-27.38,26.43-34.79,14.85-8.46,32.55-10.87,49.37-8.93,17.28,2,33.64,8.63,48.19,18,14.2,9.16,26.67,20.79,37.88,33.39,10.64,12,22.14,26.66,19.52,43.75A27.83,27.83,0,0,1,242.24,845a22.54,22.54,0,0,1-3.32,4.27c-.69.7-1.71,1.27-2.12,2.16-1.67,3.63-3,7.44-4.53,11.14L231,865.78c-.36.9,1.09,1.28,1.45.4l4.27-10.5,1.12-2.75a4.65,4.65,0,0,1,.52-1.28,3.64,3.64,0,0,0,.64-.38q.47-.4.9-.84a23.46,23.46,0,0,0,1.88-2.1,25.18,25.18,0,0,0,2.81-4.46,33.37,33.37,0,0,0,2.37-21.3c-1.73-8.47-6.32-16.12-11.52-22.91a202,202,0,0,0-17.28-19.47,189.28,189.28,0,0,0-19.38-17.07c-13.84-10.54-29.52-18.85-46.52-22.87-17.23-4.07-35.76-3.87-52.43,2.48-14.2,5.41-27.34,15.63-33.64,29.76-6.41,14.37-4,30.51,3.74,43.86,8.4,14.53,22,24.67,37.12,31.37,16.45,7.26,34.26,10.94,51.76,14.65,19.38,4.11,39.23,7.55,59.11,6.17a117.58,117.58,0,0,0,14-1.83C232.82,866.52,232.42,865.08,231.47,865.26Z" transform="translate(2.51 -737.52)"/>
          -->
        </g>
        <g id="leaf_right">
          <path id="leaf_right_path" class="cls-3" d="M346,872a3.49,3.49,0,0,0,2-1v-4h-2l-1,1-1,1v2Z" transform="translate(2.51 -737.52)"/>
          <path class="cls-2 leaf" v-bind:class="{ fadein: isFadeinLeaves, fadeout: isFadeoutLeaves }" d="M341.84,854.32c6.73-22.73,23-41.55,42.33-54.78a175.12,175.12,0,0,1,35.25-18.27,279.23,279.23,0,0,1,37-11.74c13.68-3.26,28.89-4.9,41.75,2,.85.46,1.61-.83.76-1.29-11.38-6.14-24.63-5.81-37-3.46a191.83,191.83,0,0,0-18.87,4.83c-6.56,2-13.06,4.06-19.48,6.44-23.91,8.84-46.9,21.54-63.75,41a94.9,94.9,0,0,0-19.46,34.79.75.75,0,0,0,1.45.4Z" transform="translate(2.51 -737.52)"/>
          <!--
          <path class="cls-2" d="M343.15,871.71c19.48,3.78,39.43,2,58.81-1.51,9.59-1.72,19.12-3.81,28.62-6a262.44,262.44,0,0,0,25.72-7c15.93-5.38,31.38-13.44,42.29-26.55,9.79-11.78,16-27.26,13.48-42.73-2.52-15.23-13.45-27.7-26.47-35.31-15-8.77-33-11.44-50.13-9.58-17.5,1.9-34.1,8.42-48.89,17.85-14.6,9.3-27.42,21.18-38.89,34.08-10.75,12.09-22.15,26.72-20.08,43.93a30.63,30.63,0,0,0,3,10.25,24.23,24.23,0,0,0,2.88,4.41,19.32,19.32,0,0,0,1.78,1.95c.29.29.6.57.91.84a2.3,2.3,0,0,0,.51.28,5.72,5.72,0,0,1,.57,1.4l1.15,2.82,2.79,6.85,1.4,3.44c.36.88,1.81.5,1.44-.4L340,860.7c-.59-1.44-1.11-2.94-1.77-4.35-.44-.93-1.62-1.61-2.34-2.36a22.43,22.43,0,0,1-3.25-4.32c-3.7-6.35-4.51-14.21-3.13-21.35,1.62-8.35,6.1-15.87,11.19-22.56a196.1,196.1,0,0,1,17-19.21,187.56,187.56,0,0,1,18.87-16.75c13.51-10.38,28.79-18.65,45.39-22.79,16.93-4.23,35.15-4.26,51.68,1.71,14.19,5.13,27.32,15.1,33.74,29,6.62,14.36,3.86,30.64-4.1,43.85-8.56,14.19-22.14,23.9-37.17,30.34-16.14,6.92-33.59,10.48-50.7,14.1-18.95,4-38.33,7.31-57.76,6a112.94,112.94,0,0,1-14.08-1.81C342.61,870.08,342.2,871.52,343.15,871.71Z" transform="translate(2.51 -737.52)"/>
          -->
        </g>
      </g>
    </g>
    <g id="seed"><path class="cls-4" d="M319.4,1080.88c4.48-13.82,19.87-20.41,33.7-24.86,17.45-5.62,35.91-10.56,53.95-7.25s35.39,17.17,36.84,35.46c.6,7.51-1.46,15-3.59,22.19-1.85,6.3-4.13,13.08-9.58,16.74-3.93,2.63-8.86,3.17-13.57,3.63l-25.8,2.53c-16.45,1.62-33.48,3.17-49.17-2s-29.73-19.18-29.58-35.72Z" transform="translate(2.51 -737.52)"/><path class="cls-2" d="M320.12,1081.08c3.27-9.84,12.26-15.87,21.32-19.91a141.35,141.35,0,0,1,15.48-5.58,189.54,189.54,0,0,1,19.86-5.22c12.36-2.44,25.61-3.1,37.66,1.15,9.69,3.41,18.7,9.86,24.07,18.72a31.94,31.94,0,0,1,4.67,14.46c.45,7-1.38,13.92-3.33,20.6-1.51,5.16-3.08,10.73-6.77,14.81-4.24,4.69-10.49,5.4-16.43,6-13.83,1.36-27.68,3.1-41.56,3.81-12.73.66-26.23.1-37.94-5.46-9.32-4.42-17.74-12-21.64-21.68a29.66,29.66,0,0,1-2-7.63c-.07-.59-.12-1.19-.15-1.78,0-.31-.16-1.35-.14-1.43a3.47,3.47,0,0,1,.45-.7l5.08-8,1.27-2c.52-.82-.78-1.57-1.3-.76l-4.45,7c-.71,1.11-1.46,2.21-2.14,3.34-.8,1.35-.21,3.7,0,5.19,1.5,10.64,8.6,19.65,17.24,25.65,10.49,7.3,23.34,9.7,35.92,9.92,14.32.24,28.67-1.79,42.9-3.18,3.67-.36,7.35-.68,11-1.09a33.14,33.14,0,0,0,8.76-1.91c5.39-2.17,8.63-6.79,10.75-12a84.28,84.28,0,0,0,2.69-8.19,97.33,97.33,0,0,0,2.63-10.78,36.75,36.75,0,0,0-1-17.92c-3.34-10-11.23-17.92-20.33-22.92-11-6-23.55-7.45-35.86-6.26a127.93,127.93,0,0,0-20.73,4c-6.27,1.68-12.52,3.58-18.62,5.79-9.6,3.48-19.77,8.28-25.67,17a26.16,26.16,0,0,0-3.19,6.55C318.37,1081.6,319.82,1082,320.12,1081.08Z" transform="translate(2.51 -737.52)"/></g>
  </g>
  </svg>
  <svg id="ground" xmlns="http://www.w3.org/2000/svg">
  <g><rect class="cls-5" width="100%" /></g>
  </svg>
  </div>
  </div>
</template>

<script>
export default {
  props: {
    pageWcNum: {
      type: Number,
      default: 0
    }
  },
  data: function () {
    return {
      isDoingAnimation: false,

      isFadeinLeaves: false,
      isFadeoutLeaves: false,
      isAnimatedSVG1: false,
      isHideSVG1: false,
      svg1: undefined,
      svg1_leaf_l: undefined,
      svg1_leaf_r: undefined,
      isShowLeaf: false
    }
  },
  watch: {
    pageWcNum() {
      this.draw(this.pageWcNum)
    }
  },
  methods: {
    change_isDoingAnimation(a) {
      this.isDoingAnimation = a
      this.$emit('updated', this.isDoingAnimation)
    },
    draw(pageWcNum) {
      var _this = this
      console.log(pageWcNum, this.isDoingAnimation, this.isAnimatedSVG1)
      // Page1
      var svg1PathFrom = 'M338,1078l-2-2a11.64,11.64,0,0,1-2-3l-2-4c-1-2-2-5-3-7a54.15,54.15,0,0,0-3-6c-2-3-1.14-2.14-2-3s0,0-2-3c-1.24-1.86-1-4-4-11-1.64-3.82-3.86-8.3-8-8-4,.29-7,8-8,10s-1,9-1,11c0,2.91,1,10,1,11,0,2,0,0,1,4a32.53,32.53,0,0,0,1,6c2,6,1.55,5.11,2,6,2,4,2,3,3,5,.63,1.26,1,3,2,4a12.38,12.38,0,0,1,2,3,9.67,9.67,0,0,0,2,3,32.62,32.62,0,0,1,3,3Z'
      var svg1PathMid = 'M361.57,1060.45C355,1062,347,1057,343,1053c-2-2-8.67-9.18-11-13-6.5-10.63-6-11-9-15s-3-7-5-10c-1.75-2.63-3.59-10.17-5-13-2-4-4-14-6-19-1.49-3.71-4-14-5-24-1.71-17.14,2.81-35.58-1-47-3-9-9-13-19-12-7,.7-14,12-14,18,0,2.37-2,41-2,45,0,2.91.42,25.14,1,28,.15.73,3.76,20.29,4,21,1,3,0,3,1,6,1.3,3.91,3,8,4,11l4,12c1,3,4,9,5,12a155.86,155.86,0,0,0,9,15c3.23,4.85,5,8,9,13,5.37,6.72,2,1,13.77,16.15Z'
      var svg1PathTo = 'M360.57,1060.45c-11.17-.3-14.16,2.83-21-6s-16.49-25.74-24-34c-8.95-9.85-15-59.19-15-75-1.13-20.52,16.34-54,33-66s24-19,38-40.35c3.95-6,4.1-8.73,0-14.65-3.95-5.73-17.52-4.29-23,0-16.26,12.7-43.82,26.1-52.65,44.74-1.78,3.75-4.14,8.16-8.29,8.47-4,.29-6.92-3.4-9.27-6.6-21.19-28.87-55.18-49.1-91-49.72-2.92-.06-6.93,1.27-6.35,4.12a5.05,5.05,0,0,0,1.07,1.95l16.15,21.25c5,6.61,15.94,11.47,22.32,16.79,5.73,4.77,23.92,17.67,30,22,14.86,10.55,16,34,16,59,0,0,1.23,59.43,2.23,70.15,1.77,18.88,7.87,37.88,20.46,52.06,8.64,9.74,20.19,17.11,26.51,28.49Z'
      if (pageWcNum === 11) {
        if (!this.isDoingAnimation && !this.isAnimatedSVG1) {
          this.change_isDoingAnimation(true)
          this.isAnimatedSVG1 = true
          this.infAnim(this.svg1, svg1PathFrom, svg1PathMid, svg1PathTo, 'up', 1)
          //500msくらい
          setTimeout(() => {
            _this.animLeaves()
          }, 1000)
        }
      }
    },
    infAnim(el, pathFrom, pathMid, pathTo, dir, n, animateTime=1000) {
      // MEMO: thisがvueを指していないので対策
      var _this = this
      var mid, end, fadeinORfadeout
      if (dir === 'up') {
        mid = pathMid
        end = pathTo
        fadeinORfadeout = 'fadein'
        dir = 'down'
      } else {
        mid = pathMid
        end = pathFrom
        fadeinORfadeout = 'fadeout'
        dir = 'up'
      }
      if (mid !== null) {
        el.animate({d: mid}, animateTime+500, function() {
          el.animate({d: end}, animateTime, function() {
            if (n == 2) {
              this.setLeavesVisible()
              _this.change_isDoingAnimation(false)
            }
          })
        })
      } else {
        el.animate({d: end}, animateTime, function() {
          if (n == 2) {
            _this.setLeavesVisible()
            _this.change_isDoingAnimation(false)
          }
        })
      }
    },
    animLeaves() {
      this.isShowLeaf = true
      //
      var svg1RightFrom = 'M346,872a3.49,3.49,0,0,0,2-1v-4h-2l-1,1-1,1v2Z'
      var svg1LeftFrom = 'M236,860h-4l-2-2v-4l2-1,1-1,2,1,2,1s1.41.57,0,2Z'
      var svg1RightTo = 'M343.35,871c26.68,5.24,54.19-.22,80.75-6.08,21.45-4.72,43.47-10,61.27-22.86s30.48-35.3,25.41-56.67c-3.86-16.29-17.36-29-32.73-35.7-23-9.93-50-7.66-73,2.27s-42.31,26.91-58.75,45.81c-7.28,8.38-14.25,17.52-17,28.27s-.5,23.49,8.19,30.41Z'
      var svg1LeftTo = 'M231.67,866c-26.68,5.24-54.19-.22-80.75-6.08-21.44-4.72-43.47-10-61.26-22.86s-30.49-35.3-25.42-56.67c3.86-16.29,17.36-29,32.73-35.7,23-9.93,50-7.66,73,2.27s42.32,26.91,58.75,45.81c7.29,8.38,14.25,17.52,17,28.27s.5,23.49-8.19,30.41Z'
      this.infAnim(this.svg1_leaf_l, svg1LeftFrom, null, svg1LeftTo, 'up', 2)
      this.infAnim(this.svg1_leaf_r, svg1RightFrom, null, svg1RightTo, 'up', 2)
      //
    },
    setLeavesVisible() {
      this.isFadeinLeaves = true
    }
  },
  mounted() {
    this.draw(this.pageWcNum)
    this.svg1 = window.Snap.select('#me_after_path')
    this.svg1_leaf_l = window.Snap.select('#leaf_left_path')
    this.svg1_leaf_r = window.Snap.select('#leaf_right_path')
  }
}
</script>

<style scoped>
#svgs {
  position: relative;
  width: 100%;
  height: 100%;
}
#svg1 {
  width: 100%;
  height: 100%;
}
#sl_svg {
  position: absolute;
  bottom: 20px;
  width: 100%;
  height: 70%;
}
#ground {
  position: absolute;
  bottom: 0px;
  width: 100%;
  height: 40%;
}
#ground g rect {
  width: 100%;
  height: 100%;
}
.leaf {
  opacity: 0;
}
.cls-1{fill:#f9ebb4;}
.cls-2{fill:#8a0003;}
.cls-3{fill:#3bdb00;}
.cls-4{fill:#72303a;}
.cls-5{fill:#422500;opacity:0.56;stroke:#ec0005;stroke-miterlimit:10;}

.show {
  display: block;
}
.hide {
  display: none;
}
.fadein {
  animation: fadeIn 1s ease 0s 1 forwards;
}
.fadeout {
  animation: fadeOut 500ms ease 0s 1 forwards;
}
.treebgin {
  animation: changeTreeBGColorIn 3000ms ease 0s 1 forwards;
}
.treebgout {
  animation: changeTreeBGColorOut 3000ms ease 0s 1 forwards;
}
@keyframes fadeIn {
    0% {opacity: 0}
    100% {opacity: 0.4}
}
@keyframes fadeOut {
    0% {opacity: 0.4}
    100% {opacity: 0}
}
@keyframes changeTreeBGColorIn {
    0% {fill:#f9ebb4;}
    100% {fill:#734e30;}
}
@keyframes changeTreeBGColorOut {
    0% {fill:#f9ebb4;}
    100% {fill:#734e30;}
}
</style>
